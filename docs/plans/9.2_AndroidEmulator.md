# Plan 9.2: Android Emulator Setup

## Summary

Configure Android Studio, set up the Android SDK, and create an Android Virtual Device (AVD) for testing the Walking App. This plan provides step-by-step instructions for developers to set up their local Android development environment.

## Affected Feature Slices

- **Frontend**: Android testing environment
- **Development Tools**: Android Studio and SDK

## Prerequisites

- Plan 9.1 completed (Expo project initialized)
- Computer with at least 8GB RAM
- 10GB free disk space for Android SDK
- Hardware virtualization enabled in BIOS (for emulator performance)

## Implementation Steps

### 1. Install Android Studio

**Windows:**
1. Download Android Studio from https://developer.android.com/studio
2. Run the installer (android-studio-{version}-windows.exe)
3. Follow installation wizard
4. Select "Standard" installation type
5. Ensure "Android Virtual Device" is checked

**macOS:**
1. Download Android Studio from https://developer.android.com/studio
2. Open the .dmg file
3. Drag Android Studio to Applications
4. Launch Android Studio from Applications

**Linux (Ubuntu/Debian):**
```bash
sudo snap install android-studio --classic
```

### 2. Configure Android SDK

1. Launch Android Studio
2. Click "More Actions" > "SDK Manager" (or Tools > SDK Manager if project open)
3. In "SDK Platforms" tab:
   - Check "Android 14.0 (UpsideDownCake)" - API Level 34
   - Check "Android 13.0 (Tiramisu)" - API Level 33 (fallback)
   - Click "Apply" to install

4. In "SDK Tools" tab, ensure these are installed:
   - Android SDK Build-Tools
   - Android SDK Command-line Tools
   - Android SDK Platform-Tools
   - Android Emulator
   - Intel x86 Emulator Accelerator (HAXM installer) - Windows/macOS
   - Click "Apply" to install

### 3. Set Up Environment Variables

**Windows:**
1. Open System Environment Variables
2. Add to System Variables:
   - `ANDROID_HOME`: `C:\Users\{username}\AppData\Local\Android\Sdk`
3. Add to PATH:
   - `%ANDROID_HOME%\platform-tools`
   - `%ANDROID_HOME%\emulator`
   - `%ANDROID_HOME%\tools`
   - `%ANDROID_HOME%\tools\bin`

**macOS/Linux:**
Add to `~/.bashrc`, `~/.zshrc`, or `~/.bash_profile`:
```bash
export ANDROID_HOME=$HOME/Library/Android/sdk  # macOS
# or
export ANDROID_HOME=$HOME/Android/Sdk          # Linux

export PATH=$PATH:$ANDROID_HOME/emulator
export PATH=$PATH:$ANDROID_HOME/platform-tools
export PATH=$PATH:$ANDROID_HOME/tools
export PATH=$PATH:$ANDROID_HOME/tools/bin
```

Reload shell configuration:
```bash
source ~/.bashrc  # or ~/.zshrc
```

### 4. Verify Android SDK Installation

```bash
# Check adb is accessible
adb version

# Check emulator is accessible
emulator -version

# List installed SDK platforms
sdkmanager --list_installed
```

### 5. Create Android Virtual Device (AVD)

1. In Android Studio, go to "More Actions" > "Virtual Device Manager"
2. Click "Create Device"
3. **Select Hardware**:
   - Category: Phone
   - Device: Pixel 7
   - Screen: 6.3", 1080 x 2400, 416 dpi
   - Click "Next"

4. **Select System Image**:
   - Release Name: UpsideDownCake
   - API Level: 34
   - ABI: x86_64 (or arm64-v8a for M1/M2 Macs)
   - Target: Android 14.0 (Google APIs)
   - Click "Download" if not already downloaded
   - Click "Next"

5. **Configure AVD**:
   - AVD Name: `WalkingApp_Pixel7_API34`
   - Startup orientation: Portrait
   - Click "Show Advanced Settings":
     - RAM: 2048 MB
     - VM heap: 256 MB
     - Internal Storage: 2048 MB
     - SD card: 512 MB
     - Enable "Hardware - GLES 2.0" (for better graphics)
   - Click "Finish"

### 6. Start Emulator from Command Line

```bash
# List available AVDs
emulator -list-avds

# Start the AVD
emulator -avd WalkingApp_Pixel7_API34

# Or start with options
emulator -avd WalkingApp_Pixel7_API34 -no-snapshot-load
```

**Optional flags for better performance:**
```bash
emulator -avd WalkingApp_Pixel7_API34 \
  -gpu host \
  -no-boot-anim \
  -no-snapshot-load
```

### 7. Configure Emulator Settings (Optional)

In running emulator:
1. Click "..." (Extended Controls)
2. Configure:
   - **Location**: Set to San Francisco (for testing location features)
   - **Battery**: Adjust level for testing
   - **Cellular**: Set signal strength
   - **Settings**: Enable Google Play Services

### 8. Test with Expo

```bash
# Navigate to project
cd WalkingApp.Mobile

# Start Expo development server
npx expo start

# In the terminal menu, press 'a' to open on Android
# Or scan QR code with Expo Go app
```

Verify:
- App builds successfully
- App displays on emulator
- Hot reload works when making changes

## Troubleshooting

### Emulator Won't Start

**Issue**: "HAXM is not installed" or slow performance
**Solution**:
- Windows/Intel Mac: Install Intel HAXM from SDK Manager
- Windows: Ensure Hyper-V is disabled if using HAXM
- M1/M2 Mac: Use arm64-v8a system image (native performance)

**Issue**: "KVM not available"
**Solution** (Linux):
```bash
# Check if KVM is available
egrep -c '(vmx|svm)' /proc/cpuinfo

# Install KVM
sudo apt-get install qemu-kvm libvirt-daemon-system libvirt-clients bridge-utils

# Add user to kvm group
sudo adduser $USER kvm
```

### App Not Installing

**Issue**: "INSTALL_FAILED_INSUFFICIENT_STORAGE"
**Solution**: Increase internal storage in AVD settings

**Issue**: Expo can't connect to emulator
**Solution**:
```bash
# Check adb can see emulator
adb devices

# Restart adb server
adb kill-server
adb start-server
```

### Performance Issues

**Slow emulator performance:**
1. Increase RAM allocation (up to 4GB if host has 16GB+)
2. Use GPU acceleration (`-gpu host`)
3. Disable animations (`-no-boot-anim`)
4. Use x86_64 image (Intel) or arm64-v8a (Apple Silicon)
5. Close other resource-intensive applications

## Alternative: Physical Device

If emulator performance is poor, use a physical Android device:

1. Enable Developer Options on device:
   - Go to Settings > About Phone
   - Tap "Build Number" 7 times
2. Enable USB Debugging in Developer Options
3. Connect device via USB
4. Run `adb devices` to verify connection
5. Run `npx expo start` and press 'a'

## Database Changes

None. This is a development environment setup.

## Tests

**Verification Steps**:
- [ ] Android Studio installed successfully
- [ ] Android SDK 34 installed
- [ ] Environment variables configured
- [ ] `adb version` command works
- [ ] AVD created successfully
- [ ] Emulator starts without errors
- [ ] Expo app loads on emulator
- [ ] Hot reload works in development

## Acceptance Criteria

- [ ] Android Studio installed and configured
- [ ] Android SDK API 34 installed
- [ ] Environment variables set correctly
- [ ] AVD created with Pixel 7, API 34 configuration
- [ ] Emulator starts successfully from command line
- [ ] Expo development server can connect to emulator
- [ ] Walking App displays on emulator
- [ ] Hot reload works when editing code
- [ ] Documentation includes troubleshooting guide

## Dependencies on Other Plans

**Requires**:
- Plan 9.1: Expo Project Initialization (project must exist to test)

**Blocks**:
- Plan 10: Auth Screens (need emulator to test)
- Plan 11: Onboarding (need emulator to test)
- All UI plans (need emulator to test)

## Risks and Mitigations

| Risk | Mitigation |
|------|------------|
| Emulator performance too slow | Document physical device setup alternative |
| Hardware virtualization not available | Provide workarounds or recommend physical device |
| SDK download failures | Provide mirror/alternative download links |
| Version compatibility issues | Pin to specific SDK/API versions |

## Performance Recommendations

**Minimum System Requirements**:
- CPU: Intel Core i5 or equivalent
- RAM: 8GB (16GB recommended)
- Disk: 10GB free space
- Virtualization: Enabled in BIOS

**Optimal AVD Configuration**:
- API Level: 34 (latest stable)
- RAM: 2048 MB (4096 MB if host has 16GB+)
- System Image: x86_64 with Google APIs
- GPU: Hardware acceleration enabled

## Additional Resources

- Android Studio Download: https://developer.android.com/studio
- Emulator Documentation: https://developer.android.com/studio/run/emulator
- Expo Android Setup: https://docs.expo.dev/workflow/android-studio-emulator/
- ADB Documentation: https://developer.android.com/studio/command-line/adb

